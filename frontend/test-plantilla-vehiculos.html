<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba - Plantilla Veh√≠culos 36 Campos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1976d2;
            text-align: center;
            margin-bottom: 30px;
        }
        .button {
            background: #1976d2;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background 0.3s;
        }
        .button:hover {
            background: #1565c0;
        }
        .info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid #1976d2;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
        .campos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .campo-item {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            border-left: 3px solid #1976d2;
        }
        .obligatorio {
            border-left-color: #f44336;
            background: #ffebee;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Prueba Plantilla Veh√≠culos - 36 Campos</h1>
        
        <div class="info">
            <h3>üìã Informaci√≥n de la Plantilla</h3>
            <p><strong>Total de campos:</strong> 36</p>
            <p><strong>Campos obligatorios:</strong> 2 (Placa, Sede de Registro)</p>
            <p><strong>Campos opcionales:</strong> 34</p>
            <p><strong>Formato:</strong> Excel (.xlsx) con 3 hojas</p>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button class="button" onclick="descargarPlantilla()">
                üì• Descargar Plantilla Excel (36 Campos)
            </button>
        </div>

        <div id="resultado"></div>

        <h3>üìä Lista de Campos Incluidos:</h3>
        <div class="campos-grid" id="camposGrid">
            <!-- Se llenar√° din√°micamente -->
        </div>
    </div>

    <script>
        // Definir los 36 campos seg√∫n la nueva estructura
        const columnas = [
            { campo: 'RUC Empresa', descripcion: 'RUC de la empresa transportista (11 d√≠gitos)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Resoluci√≥n Primigenia', descripcion: 'N√∫mero de resoluci√≥n primigenia', obligatorio: false, tipo: 'Texto' },
            { campo: 'DNI', descripcion: 'DNI del propietario (8 d√≠gitos)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Resoluci√≥n Hija', descripcion: 'N√∫mero de resoluci√≥n hija', obligatorio: false, tipo: 'Texto' },
            { campo: 'Fecha Resoluci√≥n', descripcion: 'Fecha de la resoluci√≥n (DD/MM/AAAA)', obligatorio: false, tipo: 'Fecha' },
            { campo: 'Tipo de Resoluci√≥n', descripcion: 'Tipo de resoluci√≥n (Autorizaci√≥n, Modificaci√≥n, etc.)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Placa de Baja', descripcion: 'Placa del veh√≠culo dado de baja (si aplica)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Placa', descripcion: 'Placa del veh√≠culo (Ej: ABC-123)', obligatorio: true, tipo: 'Texto' },
            { campo: 'Marca', descripcion: 'Marca del veh√≠culo', obligatorio: false, tipo: 'Texto' },
            { campo: 'Modelo', descripcion: 'Modelo del veh√≠culo', obligatorio: false, tipo: 'Texto' },
            { campo: 'A√±o Fabricaci√≥n', descripcion: 'A√±o de fabricaci√≥n (1990-2026)', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Color', descripcion: 'Color del veh√≠culo', obligatorio: false, tipo: 'Texto' },
            { campo: 'Categor√≠a', descripcion: 'Categor√≠a (M1, M2, M3, N1, N2, N3)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Carroceria', descripcion: 'Tipo de carrocer√≠a', obligatorio: false, tipo: 'Texto' },
            { campo: 'Tipo Combustible', descripcion: 'Tipo de combustible (Gasolina, Diesel, GLP, etc.)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Motor', descripcion: 'N√∫mero de motor', obligatorio: false, tipo: 'Texto' },
            { campo: 'N√∫mero Serie VIN', descripcion: 'N√∫mero de serie VIN del veh√≠culo', obligatorio: false, tipo: 'Texto' },
            { campo: 'Numero de pasajeros', descripcion: 'N√∫mero total de pasajeros (1-100)', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Asientos', descripcion: 'N√∫mero de asientos (1-100)', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Cilindros', descripcion: 'N√∫mero de cilindros del motor', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Ejes', descripcion: 'N√∫mero de ejes del veh√≠culo', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Ruedas', descripcion: 'N√∫mero de ruedas del veh√≠culo', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Peso Bruto (t)', descripcion: 'Peso bruto en toneladas', obligatorio: false, tipo: 'Decimal' },
            { campo: 'Peso Neto (t)', descripcion: 'Peso neto en toneladas', obligatorio: false, tipo: 'Decimal' },
            { campo: 'Carga √ötil (t)', descripcion: 'Carga √∫til en toneladas (se calcula autom√°ticamente)', obligatorio: false, tipo: 'Decimal' },
            { campo: 'Largo (m)', descripcion: 'Largo del veh√≠culo en metros', obligatorio: false, tipo: 'Decimal' },
            { campo: 'Ancho (m)', descripcion: 'Ancho del veh√≠culo en metros', obligatorio: false, tipo: 'Decimal' },
            { campo: 'Alto (m)', descripcion: 'Alto del veh√≠culo en metros', obligatorio: false, tipo: 'Decimal' },
            { campo: 'Cilindrada', descripcion: 'Cilindrada del motor en cc', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Potencia (HP)', descripcion: 'Potencia del motor en caballos de fuerza', obligatorio: false, tipo: 'N√∫mero' },
            { campo: 'Estado', descripcion: 'Estado del veh√≠culo (ACTIVO, INACTIVO, etc.)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Observaciones', descripcion: 'Observaciones adicionales del veh√≠culo', obligatorio: false, tipo: 'Texto' },
            { campo: 'Sede de Registro', descripcion: 'Sede donde se registra el veh√≠culo', obligatorio: true, tipo: 'Texto' },
            { campo: 'Expediente', descripcion: 'N√∫mero de expediente', obligatorio: false, tipo: 'Texto' },
            { campo: 'TUC', descripcion: 'N√∫mero de TUC (Ej: T-123456-2024)', obligatorio: false, tipo: 'Texto' },
            { campo: 'Rutas Asignadas', descripcion: 'Rutas asignadas al veh√≠culo (separadas por coma)', obligatorio: false, tipo: 'Texto' }
        ];

        // Ejemplos para cada campo
        const ejemplos = {
            'RUC Empresa': '20123456789',
            'Resoluci√≥n Primigenia': '0123-2025',
            'DNI': '12345678',
            'Resoluci√≥n Hija': '0124-2025',
            'Fecha Resoluci√≥n': '15/01/2024',
            'Tipo de Resoluci√≥n': 'Autorizaci√≥n',
            'Placa de Baja': 'XYZ-789',
            'Placa': 'ABC-123',
            'Marca': 'MERCEDES BENZ',
            'Modelo': 'SPRINTER',
            'A√±o Fabricaci√≥n': '2020',
            'Color': 'BLANCO',
            'Categor√≠a': 'M3',
            'Carroceria': 'MINIBUS',
            'Tipo Combustible': 'DIESEL',
            'Motor': 'MB123456789',
            'N√∫mero Serie VIN': 'VIN123456789',
            'Numero de pasajeros': '20',
            'Asientos': '20',
            'Cilindros': '4',
            'Ejes': '2',
            'Ruedas': '6',
            'Peso Bruto (t)': '5.5',
            'Peso Neto (t)': '3.5',
            'Carga √ötil (t)': '2.0',
            'Largo (m)': '8.5',
            'Ancho (m)': '2.4',
            'Alto (m)': '2.8',
            'Cilindrada': '2400',
            'Potencia (HP)': '150',
            'Estado': 'ACTIVO',
            'Observaciones': 'Veh√≠culo en buen estado',
            'Sede de Registro': 'LIMA',
            'Expediente': '01234-2025',
            'TUC': '123456',
            'Rutas Asignadas': '01,02,03'
        };

        function descargarPlantilla() {
            try {
                console.log('üöÄ Iniciando creaci√≥n de plantilla Excel...');
                
                // Crear un nuevo libro de trabajo
                const workbook = XLSX.utils.book_new();
                
                // Hoja 1: Instrucciones
                const instrucciones = [
                    ['PLANTILLA DE CARGA MASIVA DE VEH√çCULOS - SIRRET'],
                    ['Sistema Integral de Registros y Regulaci√≥n de Empresas de Transporte'],
                    [''],
                    ['INSTRUCCIONES DE USO:'],
                    ['1. Complete los datos en la hoja "DATOS" usando las columnas correspondientes'],
                    ['2. Los campos marcados como obligatorios (S√ç) deben completarse'],
                    ['3. La placa debe ser √∫nica y seguir el formato peruano (ABC-123)'],
                    ['4. Use punto (.) como separador decimal para n√∫meros'],
                    ['5. Consulte la hoja "REFERENCIA" para ver descripciones de campos'],
                    ['6. La hoja "DATOS" est√° lista para completar (sin ejemplos que eliminar)'],
                    [''],
                    ['CAMPOS OBLIGATORIOS:'],
                    ['‚Ä¢ Placa: Placa del veh√≠culo (formato ABC-123)'],
                    ['‚Ä¢ Sede de Registro: Sede donde se registra el veh√≠culo'],
                    [''],
                    ['EJEMPLOS DE DATOS V√ÅLIDOS:'],
                    ['Ejemplo 1 - Veh√≠culo de transporte p√∫blico:'],
                    ['20123456789,R-0123-2025,,R-0124-2025,15/01/2024,Autorizaci√≥n,,ABC-123,MERCEDES BENZ,SPRINTER,2020,BLANCO,M3,MINIBUS,DIESEL,MB123456789,VIN123456789,20,20,4,2,6,5.5,3.5,2.0,8.5,2.4,2.8,2400,150,ACTIVO,Veh√≠culo en buen estado,LIMA,E-01234-2025,T-123456-2024,01,02,03'],
                    [''],
                    ['Ejemplo 2 - Solo campos obligatorios:'],
                    [',,,,,,,,DEF-456,,,,,,,,,,,,,,,,,,,,,,,,,AREQUIPA,,,'],
                    [''],
                    ['FORMATOS V√ÅLIDOS:'],
                    ['‚Ä¢ Placa: 3 caracteres alfanum√©ricos + gui√≥n + 3 n√∫meros (ABC-123)'],
                    ['‚Ä¢ RUC: 11 d√≠gitos num√©ricos'],
                    ['‚Ä¢ DNI: 8 d√≠gitos num√©ricos'],
                    ['‚Ä¢ Fecha: DD/MM/AAAA (15/01/2024)'],
                    ['‚Ä¢ Resoluciones: R-0123-2025 (R + gui√≥n + 4 d√≠gitos + gui√≥n + a√±o)'],
                    ['‚Ä¢ Expediente: E-01234-2025 (E + gui√≥n + 5 d√≠gitos + gui√≥n + a√±o)'],
                    ['‚Ä¢ Rutas: 1 o 01 o 01,02,03 (n√∫meros separados por comas)'],
                    ['‚Ä¢ N√∫meros de pasajeros/asientos: Entre 1 y 100'],
                    ['‚Ä¢ TUC: T-XXXXXX-YYYY (Ej: T-123456-2024)'],
                    ['‚Ä¢ Pesos: En toneladas con decimales (3.5)'],
                    ['‚Ä¢ Dimensiones: En metros con decimales (8.5)'],
                    [''],
                    ['NOTAS IMPORTANTES:'],
                    ['‚Ä¢ Verifique que no haya placas duplicadas'],
                    ['‚Ä¢ Los datos num√©ricos deben usar formato correcto'],
                    ['‚Ä¢ La hoja DATOS est√° lista para usar - no hay ejemplos que eliminar'],
                    ['‚Ä¢ Las rutas se separan por comas si hay m√∫ltiples'],
                    ['‚Ä¢ Consulte con el administrador si tiene dudas'],
                    [''],
                    ['CAMPOS NUEVOS INCLUIDOS:'],
                    ['‚Ä¢ RUC Empresa: Para asociar veh√≠culos a empresas'],
                    ['‚Ä¢ Resoluciones: Primigenia y Hija con fechas y tipos'],
                    ['‚Ä¢ DNI: Del propietario del veh√≠culo'],
                    ['‚Ä¢ Placa de Baja: Para reemplazos de veh√≠culos'],
                    ['‚Ä¢ VIN: N√∫mero de serie del veh√≠culo'],
                    ['‚Ä¢ Cilindrada y Potencia: Especificaciones t√©cnicas'],
                    ['‚Ä¢ Expediente: N√∫mero de expediente administrativo'],
                    ['‚Ä¢ Rutas Asignadas: Rutas autorizadas para el veh√≠culo'],
                    [''],
                    ['Fecha de creaci√≥n: ' + new Date().toLocaleDateString('es-PE')],
                    ['Versi√≥n del sistema: SIRRET v1.0.0'],
                    ['Total de campos: 36 (2 obligatorios, 34 opcionales)']
                ];

                const wsInstrucciones = XLSX.utils.aoa_to_sheet(instrucciones);
                XLSX.utils.book_append_sheet(workbook, wsInstrucciones, 'INSTRUCCIONES');

                // Hoja 2: Referencia de campos
                const referencia = [
                    ['CAMPO', 'DESCRIPCI√ìN', 'OBLIGATORIO', 'TIPO', 'EJEMPLO'],
                    ...columnas.map(col => [
                        col.campo,
                        col.descripcion,
                        col.obligatorio ? 'S√ç' : 'NO',
                        col.tipo,
                        ejemplos[col.campo] || ''
                    ])
                ];

                const wsReferencia = XLSX.utils.aoa_to_sheet(referencia);
                XLSX.utils.book_append_sheet(workbook, wsReferencia, 'REFERENCIA');

                // Hoja 3: Datos (donde el usuario completar√°)
                const headers = columnas.map(col => col.campo);
                
                // Crear filas vac√≠as con el n√∫mero correcto de columnas (36)
                const filaVacia = new Array(36).fill('');
                
                const datosPlanilla = [
                    headers,
                    // Solo filas vac√≠as para que el usuario complete
                    [...filaVacia],
                    [...filaVacia],
                    [...filaVacia],
                    [...filaVacia],
                    [...filaVacia]
                ];

                const wsDatos = XLSX.utils.aoa_to_sheet(datosPlanilla);
                
                // Aplicar estilos a los headers
                const range = XLSX.utils.decode_range(wsDatos['!ref'] || 'A1');
                for (let col = range.s.c; col <= range.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                    if (!wsDatos[cellAddress]) continue;
                    wsDatos[cellAddress].s = {
                        font: { bold: true, color: { rgb: "FFFFFF" } },
                        fill: { fgColor: { rgb: "1976D2" } },
                        alignment: { horizontal: "center" }
                    };
                }

                // Establecer ancho de columnas
                wsDatos['!cols'] = headers.map(() => ({ width: 15 }));

                XLSX.utils.book_append_sheet(workbook, wsDatos, 'DATOS');

                // Generar el archivo Excel
                const excelBuffer = XLSX.write(workbook, { 
                    bookType: 'xlsx', 
                    type: 'array',
                    cellStyles: true
                });
                
                const blob = new Blob([excelBuffer], { 
                    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' 
                });
                
                // Descargar el archivo
                const fecha = new Date().toISOString().split('T')[0];
                const nombreArchivo = `plantilla_vehiculos_sirret_${fecha}.xlsx`;
                
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = nombreArchivo;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                // Mostrar mensaje de √©xito
                document.getElementById('resultado').innerHTML = `
                    <div class="success">
                        ‚úÖ <strong>Plantilla Excel generada exitosamente!</strong><br>
                        üìÅ Archivo: ${nombreArchivo}<br>
                        üìä Campos incluidos: 36<br>
                        üìã Hojas: INSTRUCCIONES, REFERENCIA, DATOS<br>
                        üéØ Listo para completar y usar
                    </div>
                `;
                
                console.log('‚úÖ Plantilla Excel creada exitosamente');
                
            } catch (error) {
                console.error('‚ùå Error creando plantilla Excel:', error);
                document.getElementById('resultado').innerHTML = `
                    <div style="background: #ffebee; color: #c62828; padding: 15px; border-radius: 4px; border-left: 4px solid #f44336;">
                        ‚ùå <strong>Error al generar la plantilla:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // Mostrar lista de campos al cargar la p√°gina
        function mostrarCampos() {
            const grid = document.getElementById('camposGrid');
            grid.innerHTML = '';
            
            columnas.forEach((col, index) => {
                const div = document.createElement('div');
                div.className = `campo-item ${col.obligatorio ? 'obligatorio' : ''}`;
                div.innerHTML = `
                    <strong>${index + 1}. ${col.campo}</strong> ${col.obligatorio ? '(OBLIGATORIO)' : ''}<br>
                    <small>${col.descripcion}</small><br>
                    <small><em>Ejemplo: ${ejemplos[col.campo] || 'N/A'}</em></small>
                `;
                grid.appendChild(div);
            });
        }

        // Cargar campos al iniciar
        document.addEventListener('DOMContentLoaded', mostrarCampos);
    </script>
</body>
</html>